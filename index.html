<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简发卡系统</title>
    <style>
        :root {
            --primary: #1890ff;
            --success: #52c41a;
            --error: #f5222d;
            --bg: #f0f2f5;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0;
            min-height: 100vh;
            background: var(--bg);
        }

        /* 前台样式 */
        .frontend {
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
        }

        /* 后台样式 */
        .backend {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-nav button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #e0e0e0;
        }

        .admin-nav button.active {
            background: var(--primary);
            color: white;
        }

        .admin-panel {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .admin-panel.active {
            display: block;
        }

        /* 公共样式 */
        .input-field {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
        }

        #adminEntry {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .copy-btn {
            background: var(--success);
            color: white;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- 前台界面 -->
    <div class="frontend">
        <h2>短信任务发卡系统</h2>
        <input type="tel" id="phone" class="input-field" placeholder="手机号码" pattern="\d{11}">
        
        <div style="margin:20px 0">
            <h3>任务1：发送短信1到指定号码</h3>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="System.sendSMS(1)">发送短信</button>
                <button class="btn btn-primary" id="getCode1" onclick="System.getCode(1)" disabled>获取验证码</button>
            </div>
            <input type="text" id="code1" class="input-field" placeholder="验证码" disabled style="margin-top:10px">
        </div>

        <div style="margin:20px 0">
            <h3>任务2：发送短信注册QQ</h3>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="System.sendSMS(2)">发送短信</button>
                <button class="btn btn-primary" id="getCode2" onclick="System.getCode(2)" disabled>获取验证码</button>
            </div>
            <input type="text" id="code2" class="input-field" placeholder="验证码" disabled style="margin-top:10px">
        </div>

        <div id="cardResult" style="display:none">
            <h3>领取的卡密：</h3>
            <div id="cardContent" style="padding:10px; background:#f0f0f0"></div>
            <button class="btn copy-btn" onclick="System.copyCard()">一键复制</button>
        </div>
    </div>

    <!-- 后台界面 -->
    <div class="backend">
        <div class="admin-nav">
            <button onclick="System.showPanel('users')" class="active">用户管理</button>
            <button onclick="System.showPanel('cards')">卡密管理</button>
            <button onclick="System.showPanel('settings')">系统设置</button>
            <button onclick="System.logout()" style="margin-left:auto">退出登录</button>
        </div>

        <!-- 用户管理 -->
        <div id="usersPanel" class="admin-panel active">
            <h3>用户记录</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>已领取用户</h4>
                    <div id="completedUsers" style="height:300px; overflow-y:auto"></div>
                </div>
                <div>
                    <h4>未完成用户</h4>
                    <div id="pendingUsers" style="height:300px; overflow-y:auto"></div>
                </div>
            </div>
        </div>

        <!-- 卡密管理 -->
        <div id="cardsPanel" class="admin-panel">
            <h3>卡密管理</h3>
            <textarea id="newCards" style="width:100%; height:150px" placeholder="每行一个卡密"></textarea>
            <button class="btn btn-primary" onclick="System.addCards()" style="margin-top:10px">添加卡密</button>
            <div style="margin-top:20px">
                <h4>剩余卡密（<span id="cardCount">0</span>）</h4>
                <div id="cardList" style="height:200px; overflow-y:auto"></div>
            </div>
        </div>

        <!-- 系统设置 -->
        <div id="settingsPanel" class="admin-panel">
            <h3>修改账号密码</h3>
            <input type="text" id="newUsername" class="input-field" placeholder="新账号">
            <input type="password" id="newPassword" class="input-field" placeholder="新密码" style="margin:10px 0">
            <button class="btn btn-primary" onclick="System.changePassword()">保存修改</button>
        </div>
    </div>

    <!-- 登录模态框 -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h3>管理员登录</h3>
            <input type="text" id="loginUser" class="input-field" placeholder="账号">
            <input type="password" id="loginPass" class="input-field" placeholder="密码" style="margin:10px 0">
            <div style="text-align:right">
                <button class="btn" onclick="System.hideLogin()">取消</button>
                <button class="btn btn-primary" onclick="System.doLogin()">登录</button>
            </div>
        </div>
    </div>

    <button id="adminEntry" class="btn btn-primary" onclick="System.showLogin()">管理员登录</button>
    <button id="adminExit" class="btn btn-primary" style="display:none; position:fixed; top:20px; right:20px;" onclick="System.logout()">退出登录</button>

<script>
const System = (() => {
    const state = {
        currentPanel: 'users',
        codes: {},
        timers: {}
    };

    // 初始化存储
    function initStorage() {
        if(!localStorage.admin) localStorage.admin = JSON.stringify({
            username: "admin",
            password: "admin123"
        });
        if(!localStorage.cards) localStorage.cards = JSON.stringify([]);
        if(!localStorage.users) localStorage.users = JSON.stringify({
            completed: [],
            pending: []
        });
    }

    // 显示面板
    function showPanel(panel) {
        state.currentPanel = panel;
        document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
        document.getElementById(`${panel}Panel`).classList.add('active');
        document.querySelectorAll('.admin-nav button').forEach(btn => {
            btn.classList.toggle('active', btn.onclick?.toString().includes(panel));
        });
    }

    // 卡密管理
    function addCards() {
        const cards = document.getElementById('newCards').value.split('\n');
        const stored = JSON.parse(localStorage.cards);
        localStorage.cards = JSON.stringify([...stored, ...cards]);
        refreshCards();
    }

    // 用户管理
    function refreshUsers() {
        const users = JSON.parse(localStorage.users);
        document.getElementById('completedUsers').innerHTML = users.completed
            .map(u => `<div>${u.phone} - ${u.card}</div>`).join('');
        document.getElementById('pendingUsers').innerHTML = users.pending
            .map(u => `<div>${u}</div>`).join('');
    }

    // 卡密显示
    function refreshCards() {
        const cards = JSON.parse(localStorage.cards);
        document.getElementById('cardList').innerHTML = cards.join('<br>');
        document.getElementById('cardCount').textContent = cards.length;
    }

    // 修改密码
    function changePassword() {
        const admin = JSON.parse(localStorage.admin);
        admin.username = document.getElementById('newUsername').value || admin.username;
        admin.password = document.getElementById('newPassword').value || admin.password;
        localStorage.admin = JSON.stringify(admin);
        alert('修改成功');
    }

    // 登录系统
    function doLogin() {
        const admin = JSON.parse(localStorage.admin);
        const username = document.getElementById('loginUser').value;
        const password = document.getElementById('loginPass').value;

        if(username === admin.username && password === admin.password) {
            document.querySelector('.frontend').style.display = 'none';
            document.querySelector('.backend').style.display = 'block';
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('adminEntry').style.display = 'none';
            document.getElementById('adminExit').style.display = 'block';
            refreshCards();
            refreshUsers();
        } else {
            alert('账号或密码错误');
        }
    }

    // 退出登录
    function logout() {
        document.querySelector('.frontend').style.display = 'block';
        document.querySelector('.backend').style.display = 'none';
        document.getElementById('adminEntry').style.display = 'block';
        document.getElementById('adminExit').style.display = 'none';
    }

    // 短信功能
    function sendSMS(task) {
        const phone = document.getElementById('phone').value;
        if(!/^\d{11}$/.test(phone)) return alert('请输入有效手机号');
        
        // 记录未完成用户
        const users = JSON.parse(localStorage.users);
        if(!users.completed.some(u => u.phone === phone)) {
            users.pending.push(phone);
            localStorage.users = JSON.stringify(users);
            refreshUsers();
        }

        // 跳转短信
        window.location.href = `sms:106988881700511?body=${task === 1 ? '1' : '注册QQ'}`;
        
        // 生成验证码
        setTimeout(() => {
            const code = Math.floor(100000 + Math.random() * 900000);
            state.codes[task] = code;
            alert(`测试验证码：${code}`);
            document.getElementById(`code${task}`).disabled = false;
        }, 1000);
    }

    // 复制卡密
    function copyCard() {
        const card = document.getElementById('cardContent').textContent;
        navigator.clipboard.writeText(card).then(() => {
            alert('卡密已复制到剪贴板');
        }).catch(err => {
            alert('复制失败，请手动复制');
        });
    }

    return {
        init: () => {
            initStorage();
            // 绑定输入验证
            document.getElementById('phone').addEventListener('input', function(e) {
                const isValid = /^\d{11}$/.test(e.target.value);
                this.style.borderColor = isValid ? '#ddd' : 'var(--error)';
            });
        },
        showLogin: () => document.getElementById('loginModal').style.display = 'flex',
        hideLogin: () => document.getElementById('loginModal').style.display = 'none',
        doLogin,
        logout,
        showPanel,
        addCards,
        changePassword,
        sendSMS,
        copyCard
    };
})();

// 初始化系统
document.addEventListener('DOMContentLoaded', System.init);
</script>
</body>
</html>
